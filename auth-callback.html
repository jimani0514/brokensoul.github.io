<!DOCTYPE html>
<html>
<head>
    <title>인증 중개 페이지</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // URL 해시나 쿼리 파라미터에서 인증 정보 추출
        const hash = window.location.hash.substring(1);
        const query = window.location.search.substring(1);
        
        // 인증 정보를 가져오는 함수
        function extractAuthData() {
            // 해시에서 토큰 추출 시도
            if(hash && hash.includes('access_token=')) {
                return hash;
            }
            
            // 쿼리에서 코드 추출 시도
            if(query && query.includes('code=')) {
                return query;
            }
            
            return null;
        }
        
        const authData = extractAuthData();
        
        if(authData) {
            // 로그 추가 (디버깅용)
            console.log('인증 정보 감지됨:', authData);
            document.getElementById('status').innerText = '인증 정보를 앱으로 전달 중...';
            
            // 딥링크로 인증 정보 전달
            let deeplink = 'mygame://login-callback';
            
            // 딥링크에 인증 정보 추가
            if(authData.startsWith('access_token=')) {
                deeplink += '#' + authData; // 해시로 추가
            } else {
                deeplink += '?' + authData; // 쿼리로 추가
            }
            
            // 모바일 환경인지 체크
            const isMobile = /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
            
            // 3초 후 딥링크로 이동 (지연 추가)
            setTimeout(function() {
                window.location.href = deeplink;
                
                // 모바일 환경에만 타임아웃 추가
                if(isMobile) {
                    // 딥링크 이동 5초 후에도 페이지가 남아있다면 앱 설치 여부 체크
                    setTimeout(function() {
                        document.getElementById('status').innerText = '앱으로 이동 중 문제가 발생했습니다. 앱이 설치되어 있는지 확인해주세요.';
                    }, 5000);
                }
            }, 1500);
            
        } else {
            document.getElementById('status').innerText = '인증 정보가 없습니다.';
        }
    });
    </script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin-top: 100px;
            background-color: #000;
            color: #fff;
        }
        .loader {
            border: 5px solid #333;
            border-top: 5px solid #9c6;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <h2>Broken Soul</h2>
    <div class="loader"></div>
    <p id="status">로그인 정보 처리 중...</p>
</body>
</html>